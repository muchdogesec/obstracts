FROM python:3.11
ENV PYTHONUNBUFFERED=1

ARG DJANGO_SECRET=
ARG DJANGO_DEBUG=
ARG CELERY_BROKER_CONNECTION_RETRY_ON_STARTUP=
ARG MAX_PAGE_SIZE=
ARG DEFAULT_PAGE_SIZE=
ARG BIN_LIST_API_KEY=
ARG OPENAI_API_KEY=
ARG ANTHROPIC_API_KEY=
ARG GOOGLE_API_KEY=
ARG INPUT_TOKEN_LIMIT=
ARG CTIBUTLER_HOST=
ARG VULMATCH_HOST=
ARG GOOGLE_VISION_API_KEY=
ARG USE_S3_STORAGE=
ARG R2_ENDPOINT_URL=
ARG R2_BUCKET_NAME=
ARG R2_ACCESS_KEY=
ARG R2_SECRET_KEY= 
ARG R2_CUSTOM_DOMAIN=
ARG POSTGRES_DB=
ARG POSTGRES_USER=
ARG POSTGRES_PASSWORD=
ARG POSTGRES_HOST=
ARG ARANGODB_HOST_URL=
ARG ARANGODB_USERNAME=
ARG ARANGODB_PASSWORD=

ENV DJANGO_SECRET=${DJANGO_SECRET}
ENV DJANGO_DEBUG=${DJANGO_DEBUG}
ENV CELERY_BROKER_CONNECTION_RETRY_ON_STARTUP=1
ENV MAX_PAGE_SIZE=50
ENV DEFAULT_PAGE_SIZE=50
ENV BIN_LIST_API_KEY=${BIN_LIST_API_KEY}
ENV OPENAI_API_KEY=${OPENAI_API_KEY}
ENV ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY} 
ENV GOOGLE_API_KEY=${GOOGLE_API_KEY}
ENV INPUT_TOKEN_LIMIT=${INPUT_TOKEN_LIMIT}
ENV CTIBUTLER_HOST=${CTIBUTLER_HOST}
ENV VULMATCH_HOST=${VULMATCH_HOST}
ENV GOOGLE_VISION_API_KEY=${GOOGLE_VISION_API_KEY}
ENV USE_S3_STORAGE=1
ENV R2_ENDPOINT_URL=${R2_ENDPOINT_URL}
ENV R2_BUCKET_NAME=${R2_BUCKET_NAME}
ENV R2_ACCESS_KEY=${R2_ACCESS_KEY}
ENV R2_SECRET_KEY=${R2_SECRET_KEY}
ENV R2_CUSTOM_DOMAIN=${R2_CUSTOM_DOMAIN}
ENV POSTGRES_DB=${POSTGRES_DB}
ENV POSTGRES_USER=${POSTGRES_USER}
ENV POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
ENV POSTGRES_HOST=${POSTGRES_HOST}
ENV ARANGODB_HOST_URL=${ARANGODB_HOST_URL}
ENV ARANGODB_USERNAME=${ARANGODB_USERNAME}
ENV ARANGODB_PASSWORD=${ARANGODB_PASSWORD}

WORKDIR /usr/src/app
COPY requirements.txt ./
RUN pip install -r requirements.txt

COPY . /usr/src/app